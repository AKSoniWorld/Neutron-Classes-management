<html lang="pt">
<head>
  <% include ../partes/head %>
</style>
<% include ../partes/head %>
<script>
$( function() {
  $( "#datepicker" ).datepicker({
    yearRange: '1900:2050',
    changeMonth: true,
    changeYear: true,
    altFormat: "yy-mm-dd",
    altField: "#alt-date"
  });
} );

//Pesquisa as turmas
$( function() {


});


$(function(){

  //Define o ano atual como valor máximo pro campo 'ano'
  var currentYear = (new Date).getFullYear();
  $('#ano').attr('max', currentYear);

  //Pesquisa as disciplinas do professor
  var autor = "<%= user %>";


  $.ajax({
    url: "/pesqDisc",  // AQUI É A URL QUE SERA ENVIADO
    type: "POST",   //TIPO DE ENVIO
    dataType: "json", //TIPO DE DADO QUE SERA PASSADO
    data:JSON.stringify({
      autor: autor
    }),

    contentType: "application/json",
    cache: false,
    timeout: 5000,
    complete: function() {
      console.log('process complete');

    },
    success: function(data) {
      console.log('process sucess');
      $("#disciplina").empty();
      $("#disciplina").append($("<option disabled selected />").val('Disciplina').text('Disciplina'));
      for(var i = 0; i < data.length; i++) {
        $("#disciplina").append($("<option />").val(data[i]).text(data[i]));
        console.log(data[i]);
      }
    },

    error: function() {
      console.log('process error');
    },
  });


  //PEsquisa as turmas
  var autor = <%= userMat %>;

  $.ajax({
    url: "/mostraturma",  // AQUI É A URL QUE SERA ENVIADO
    type: "POST",   //TIPO DE ENVIO
    dataType: "json", //TIPO DE DADO QUE SERA PASSADO
    data:JSON.stringify({
      matricula: autor
    }),

    contentType: "application/json",
    cache: false,
    timeout: 5000,
    complete: function() {
      console.log('process complete');
    },

    success: function(data) {
      console.log('process sucess');
      $("#turma").empty();
      $("#turma").append($("<option disabled selected />").val('Turma').text('Turma'));
      for(var i = 0; i < data.length; i++) {
        $("#turma").append($("<option />").val(data[i]).text(data[i]));
        console.log(data[i]);
      }
    },

    error: function() {
      console.log('process error');
    },
  });


});


//Pesquisa os alunos da turma
$( function chamaAlunos() {
  $("#turma").change(function(){

    var turma = $('#turma').val();

    $.ajax({
      url: "/pegaaluno",  // AQUI É A URL QUE SERA ENVIADO
      type: "POST",   //TIPO DE ENVIO
      dataType: "json", //TIPO DE DADO QUE SERA PASSADO
      data:JSON.stringify({
        nometurma: turma,
      }),

      contentType: "application/json",
      cache: false,
      timeout: 5000,
      complete: function() {
        console.log('process complete');
      },
      success: function(data) {
        console.log('process sucess');
        $("#tableDados").empty();
        for(var i = 0; i < data.length; i++) {
          $("#tableDados").append($("<tr/>")
          .append($("<th class='celulasCB'/>").val(i+1).text(i+1))
          .append($("<td class='celulasCB, aluno'/>").val(data[i][0]).text(data[i][0]))
          .append($("<td style='text-align: center' class='celulasCB'/>")
          .append("<input type='number' id='nota' name='nota' style='width: 50px' min = '0' class='nota' required/> "))
        );
        console.log(data[i]);
      }
      $('#avaliacao').val("1");
    },

    error: function() {
      console.log('process error');
    },
  });
});
});


$(function(){
  $('#avaliacao').change(function(){

    var tipo = $('#avaliacao').val();

    if(tipo == "Prova (7 pontos)")
    $('.nota').attr('max', 7);

    else if (tipo == "Teste (3 pontos)")

    $('.nota').attr('max', 3);
  })
});
</script>
</head>
<body>
  <div class="all">

      <% include ../partes/topmenu.ejs %>

            <div class=" col-xs-2 col-sm-2 col-md-2 col-lg-2 fixed">
                <% include ../partes/sidemenu.ejs %>
            </div>
    <div class="row">

      <div class="container-fluid">

        <div class="content col-xs-10 col-sm-10 col-md-10 col-lg-10 ">
          <H3>Cadastro de Notas</H3>
          <br>

          <form class="form-inline" action="/cadastroNotas" method="post" name="cadastroNota">

            <input type="text" id="prof" name="prof" value="<%= user %>" class="form-control" style="width:300px;" disabled required>&nbsp&nbsp

            <select class="form-control" id="disciplina" name="disciplina" style="width:300px;" required>
              <option disabled selected value="1">Disciplina</option>
            </select><br><br>

            <select class="form-control" id="turma" name="turma" style="width:300px;" required>
              <option disabled selected value="1">Turma</option>
            </select>&nbsp&nbsp

            <select class="form-control" id="avaliacao" name="avaliacao" style="width:300px;" required>
              <option disabled selected value="1">Tipo de Avaliação</option>
              <option>Prova (7 pontos)</option>
              <option>Teste (3 pontos)</option>
            </select><br><br>

            <input type="number" id="ano" name="ano" value="" class="form-control" style="width:300px;" placeholder="Ano" min='1900'required>&nbsp&nbsp

            <select class="form-control" id="periodo" name="periodo" style="width:300px;" required>
              <option disabled selected value="1">Período</option>
              <option>1ª Certificação</option>
              <option>2ª Certificação</option>
              <option>3ª Certificação</option>
            </select><br><br>


            <div class="" style="width:610px; text-align: center;">
              <table class="table" style="width:610px;" id="tableToda" name="tableToda">
                <thead class="thead-inverse">
                  <tr>
                    <th class="celulasCB"   >#</th>
                    <th class="celulasCB" >Aluno</th>
                    <th class="celulasCB" style='text-align: center'>Nota</th>
                  </tr>

                </thead>
                <tbody id="tableDados" name="tableDados">

                </tbody>
              </table>
              <input type="submit" name="cadastrar" class="btn btn-default">
            </div>



          </form>

        </div>

        <div class="footer">
          <footer>
            <% include ../partes/footer %>
          </footer>
        </div>
      </div>

    </div>
  </body>

  </html>
